<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Inventario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/categorias.css">
</head>

<body>
<div class="items-container mb-5">
    <h1 class="p-4 pb-2 text-center">Gestor de Inventario</h1>
    <hr>

    <div class="filters-btns ms-4" role="group" aria-label="Opciones de filtros">
        <button type="button" aria-label="Listado" id="btn-filtrar" class="btn btn-sm">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                 class="bi bi-filter-circle mx-1" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                <path
                        d="M7 11.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m-2-3a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m-2-3a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5" />
            </svg>
            Filtrar
        </button>

        <button type="button" aria-label="Listado" class="btn btn-sm " id="btn-ordenar">
            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor"
                 class="bi bi-sort-down-alt mx-1" viewBox="0 0 16 16">
                <path
                        d="M3.5 3.5a.5.5 0 0 0-1 0v8.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L3.5 12.293zm4 .5a.5.5 0 0 1 0-1h1a.5.5 0 0 1 0 1zm0 3a.5.5 0 0 1 0-1h3a.5.5 0 0 1 0 1zm0 3a.5.5 0 0 1 0-1h5a.5.5 0 0 1 0 1zM7 12.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7a.5.5 0 0 0-.5.5" />
            </svg>
            Ordenar
        </button>

        <button type="button" aria-label="Listado" class="btn btn-sm" id="btn-mostrar-productos">
            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor" class="bi bi-box-seam mx-1" viewBox="0 0 16 16">
                <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
            </svg>
            Productos
        </button>
    </div>
    <!-- Encabezado de la tabla (solo visible en desktop) -->
    <div class="d-none d-md-grid table-header" style="grid-template-columns: 1fr 2fr;">
        <div class="text-center">Imagen</div>
        <div class="text-center">Detalles</div>
    </div>

    <!-- Productos Disponibles -->

    <div class="product-item text-center my-4" th:if="${#lists.isEmpty(categorias_lista)}">
        No Hay Categorías Disponibles
    </div>
    <div th:each="cat : ${categorias_lista}" class="product-item px-3 my-3">
        <div class="row">
            <div class="col-md-6 mx-auto my-3">
                <img th:src="@{${cat.url_imagen}}" alt="Imagen de Categoria" id="img-categoria" class="ms-5 my-3">
            </div>
            <div class="col-md-6 mx-auto my-3">
                <div class="my-2 ms-3  fw-bold category" th:text="${'Categoría: ' + cat.categoria}">Categoría</div>
                <div class="my-2 ms-3 descripcion" th:text="${'Descripción: ' + cat.descripcion}">Descripción</div>
                <div class="my-2 ms-3 category-url" th:text="${'URL: ' + cat.url_imagen}" style="color: #6c757d;">Url Imagen</div>
                <div class="my-2 ms-3 fw-bold category-products" th:text="${'Productos Relacionados: ' + cat.productos.size}">No. Productos</div>
                <!-- Botones de acción -->
                <div class="action-buttons mt-2">

                    <!-- Botón de edición -->
                    <button type="button" class="btn btn-sm btn-primary ms-3 btn-editar" data-bs-toggle="modal"
                            data-bs-target="#modal-editar-categoria" th:data-id="${cat.id}"
                            th:data-categoria="${cat.categoria}" th:data-descripcion="${cat.descripcion}"
                            th:data-url_imagen="${cat.url_imagen}">
                        Editar
                    </button>

                    <!-- Boton de eliminacion -->
                    <button class="btn btn-sm btn-danger ms-4 btn-eliminar"
                            th:attr="data-url=@{/api/admin/categorias/delete/{id}(id=${cat.id})}">
                        Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>
    <hr>
    <div class="d-flex justify-content-center mb-4">
        <button class="btn btn-link" data-bs-target="#modal-nueva-categoria" data-bs-toggle="modal">
            Nueva Categoría +
        </button>
    </div>
</div>

<footer class="container-fluid mt-3">
    <nav class="footer-nav" role="navigation" aria-label="Navegación inferior">
        <button class="active" aria-label="Inicio">
            <a th:href="@{/api/admin/productos/all}">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="26" fill="currentColor"
                     class="bi bi-database-check" viewBox="0 0 16 16">
                    <path
                            d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514" />
                    <path
                            d="M12.096 6.223A5 5 0 0 0 13 5.698V7c0 .289-.213.654-.753 1.007a4.5 4.5 0 0 1 1.753.25V4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16c.536 0 1.058-.034 1.555-.097a4.5 4.5 0 0 1-.813-.927Q8.378 15 8 15c-1.464 0-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13h.027a4.6 4.6 0 0 1 0-1H8c-1.464 0-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10q.393 0 .774-.024a4.5 4.5 0 0 1 1.102-1.132C9.298 8.944 8.666 9 8 9c-1.464 0-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777M3 4c0-.374.356-.875 1.318-1.313C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4" />
                </svg>
            </a>
            Gestor Inventario
        </button>

        <button aria-label="Cuentas">
            <a href="usuarios.html"><svg xmlns="http://www.w3.org/2000/svg" width="26" height="26"
                                         fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
                <path
                        d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4" />
            </svg>
            </a>
            Gestionar Cuentas
        </button>
        <button aria-label="pedidos">
            <a href="pedidos.html">
                <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor"
                     class="bi bi-receipt-cutoff" viewBox="0 0 16 16">
                    <path
                            d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5M11.5 4a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1z" />
                    <path
                            d="M2.354.646a.5.5 0 0 0-.801.13l-.5 1A.5.5 0 0 0 1 2v13H.5a.5.5 0 0 0 0 1h15a.5.5 0 0 0 0-1H15V2a.5.5 0 0 0-.053-.224l-.5-1a.5.5 0 0 0-.8-.13L13 1.293l-.646-.647a.5.5 0 0 0-.708 0L11 1.293l-.646-.647a.5.5 0 0 0-.708 0L9 1.293 8.354.646a.5.5 0 0 0-.708 0L7 1.293 6.354.646a.5.5 0 0 0-.708 0L5 1.293 4.354.646a.5.5 0 0 0-.708 0L3 1.293zm-.217 1.198.51.51a.5.5 0 0 0 .707 0L4 1.707l.646.647a.5.5 0 0 0 .708 0L6 1.707l.646.647a.5.5 0 0 0 .708 0L8 1.707l.646.647a.5.5 0 0 0 .708 0L10 1.707l.646.647a.5.5 0 0 0 .708 0L12 1.707l.646.647a.5.5 0 0 0 .708 0l.509-.51.137.274V15H2V2.118z" />
                </svg>
            </a>
            Gestionar Pedidos
        </button>
        <button aria-label="Perfil">
            <a href="login.html"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"
                                      aria-hidden="true">
                <circle cx="12" cy="7" r="4" />
                <path d="M5.5 21a6.5 6.5 0 0 1 13 0" />
            </svg>
            </a>
            Perfil
        </button>
    </nav>
</footer>


<!-- Modal nueva Categoria -->
<div id="modal-nueva-categoria" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Nueva Categoría</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar">
                </button>
            </div>

            <form th:action="@{/api/admin/categorias/save}" th:object="${categoriaDTO}" method="post">
                <input type="hidden" th:field="*{id}" />
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row gx-2">

                            <!-- Nombre de la categoría -->
                            <div class="col-12 mb-3">
                                <label for="categoriaTxt" class="form-label">Categoría</label>
                                <input type="text" th:field="*{categoria}" class="form-control" id="categoriaTxt"
                                       required placeholder="Nombre de la categoría">
                            </div>

                            <!-- Descripción -->
                            <div class="col-12 mb-3">
                                <label for="descripcionTxt" class="form-label">Descripción</label>
                                <textarea th:field="*{descripcion}" class="form-control" id="descripcionTxt"
                                          rows="3" required placeholder="Descripción de la categoría"></textarea>
                            </div>

                            <!-- URL de la imagen -->
                            <div class="col-12 mb-3">
                                <label for="urlImagen" class="form-label">URL de Imagen</label>
                                <input type="url" th:field="*{url_imagen}" class="form-control" id="urlImagen"
                                       required placeholder="https://...">
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal-footer justify-content-evenly">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Cerrar
                    </button>
                    <button type="submit" class="btn btn-success">
                        Agregar
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- Modal Editar Categoria -->
<div id="modal-editar-categoria" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="editar-modal-title">Editar Categoría</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar">
                </button>
            </div>

            <form id="form-editar-categoria" data-action-template="/api/admin/categorias/edit/{id}" th:object="${categoriaDTO}"
                  method="post">
                <input type="hidden" th:field="*{id}" id="editar-id" />

                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row gx-2">

                            <div class="col-12 mb-3">
                                <label for="editar-categoriaTxt" class="form-label">
                                    Categoría
                                </label>
                                <input type="text" th:field="*{categoria}" class="form-control"
                                       id="editar-categoriaTxt" name="categoria" required
                                       placeholder="Nombre de la categoría" />
                            </div>

                            <div class="col-12 mb-3">
                                <label for="editar-descripcionTxt" class="form-label">
                                    Descripción
                                </label>
                                <textarea th:field="*{descripcion}" class="form-control" id="editar-descripcionTxt"
                                          name="descripcion" rows="3" required
                                          placeholder="Descripción de la categoría"></textarea>
                            </div>

                            <div class="col-12 mb-3">
                                <label for="editar-urlImagen" class="form-label">
                                    URL de Imagen
                                </label>
                                <input type="url" th:field="*{url_imagen}" class="form-control"
                                       id="editar-urlImagen" name="url_imagen" required placeholder="https://..." />
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal-footer justify-content-evenly">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Cerrar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Guardar
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/js/categorias.js"></script>

<script>
 document.addEventListener('DOMContentLoaded', () => {
   const formEditar = document.getElementById('form-editar-categoria');

   document.querySelectorAll('.btn-editar').forEach(btn => {
     btn.addEventListener('click', () => {
       const id          = btn.getAttribute('data-id');
       const categoria   = btn.getAttribute('data-categoria');
       const descripcion = btn.getAttribute('data-descripcion');
       const urlImagen   = btn.getAttribute('data-url_imagen');
       const template    = formEditar.dataset.actionTemplate;

       // Pobla los inputs
       document.getElementById('editar-id').value             = id;
       document.getElementById('editar-categoriaTxt').value   = categoria;
       document.getElementById('editar-descripcionTxt').value = descripcion;
       document.getElementById('editar-urlImagen').value      = urlImagen;

       formEditar.setAttribute('action',
         template.replace('{id}', id)
       );
     });
   });

   // Limpieza al cerrar (opcional)
   const editarModal = document.getElementById('modal-editar-categoria');
   editarModal.addEventListener('hidden.bs.modal', () => {
     ['editar-id','editar-categoriaTxt','editar-descripcionTxt','editar-urlImagen']
       .forEach(fieldId => document.getElementById(fieldId).value = '');
   });
 });

</script>
</body>

</html>