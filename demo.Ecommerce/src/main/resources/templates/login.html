<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Magnolias de Acero - Login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/css/login.css">
</head>

<body>

<main class="login-container">
  <h1 class="login-title my-3">Magnolias de Acero</h1>
  <h2 class="login-subtitle">Inicia Sesión</h2>
  <p class="text-instruction">Puedes usar tu correo electrónico para registrarte en esta aplicación</p>
  <form method="POST" th:action="@{/api/demo/productos/auth}">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

    <input type="text" name="username" placeholder="Usuario" class="form-control text-center" required />
    <br>
    <input type="password" name="password" placeholder="***" class="form-control text-center" required />
    <button type="submit" class="btn btn-primary w-100">Continuar</button>
  </form>

  <div class="divider"></div>

  <button type="button" class="btn-google" onclick="window.location.href='/oauth2/authorization/google'">

    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <path
              d="M17.64 9.20454c0-.63818-.05727-1.25-.16273-1.83773H9v3.48182h4.84455c-.20864 1.125-.84227 2.08227-1.8 2.73v2.27364h2.91c1.70318-1.56727 2.68636-3.87545 2.68636-6.64773z"
              fill="#4285F4" />
      <path
              d="M9 18c2.43 0 4.46818-.80364 5.95727-2.18227l-2.91-2.27364c-.80636.54-1.83773.86-3.04818.86-2.34 0-4.32-1.58-5.02727-3.7H.97818v2.32818A8.99455 8.99455 0 009 18z"
              fill="#34A853" />
      <path
              d="M3.97273 10.5045a5.39727 5.39727 0 010-3.00909V5.16727H.97818a8.99818 8.99818 0 000 7.66636l2.99455-2.32409z"
              fill="#FBBC05" />
      <path
              d="M9 3.57909c1.32273 0 2.51.45545 3.44455 1.34727l2.58273-2.58273C13.46273.961818 11.42454 0 9 0A8.99455 8.99455 0 00.97818 5.16727l2.99455 2.32818c.70545-2.12 2.68727-3.91636 5.02727-3.91636z"
              fill="#EA4335" />
    </svg>
    Continuar con Google
  </button>

  <p class="privacy-text">
    Al hacer clic en continuar, aceptas nuestros
    <a href="#" target="_blank" rel="noopener noreferrer">Términos de servicio</a> y
    <a href="#" target="_blank" rel="noopener noreferrer">Política de privacidad</a>
  </p>

  <div class="mt-3">
    <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#registroModal">
      ¿No tienes Cuenta? Regístrate
    </button>
  </div>
</main>

<footer class="container-fluid">
  <nav class="footer-nav" role="navigation" aria-label="Navegación inferior">
    <button class="active" aria-label="Inicio">
      <a th:href="@{'/api/demo/productos/all'}"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"
                                                     aria-hidden="true">
        <path d="M3 9.5l9-7 9 7V20a2 2 0 0 1-2 2h-4v-6H9v6H5a2 2 0 0 1-2-2z" />
      </svg>
      </a>
      Inicio
    </button>

    <button aria-label="Perfil">
      <a th:href="@{'/api/demo/productos/login'}"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"
                                                       aria-hidden="true">
        <circle cx="12" cy="7" r="4" />
        <path d="M5.5 21a6.5 6.5 0 0 1 13 0" />
      </svg>
      </a>
      Perfil
    </button>
  </nav>
</footer>

<!-- Modal -->
<div class="modal fade" id="registroModal" tabindex="-1" aria-labelledby="registroModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow-lg border-0 rounded-3">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="registroModalLabel">Crear Cuenta</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body p-4">
        <form id="registroForm">
          <input type="hidden" name="_csrf" th:value="${_csrf.token}" th:name="${_csrf.parameterName}">
          <div class="mb-3">
            <label for="username" class="form-label">Usuario</label>
            <input type="text" class="form-control" id="username" name="username" required>
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="password" name="password" required>
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-success">Registrarme</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.getElementById("registroForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const csrfToken = document.querySelector('input[name="_csrf"]').value;

      const formData = {
          username: document.getElementById("username").value,
          password: document.getElementById("password").value,

      };

      fetch("/api/demo/productos/registro", {
          method: "POST",
          headers: {
              "Content-Type": "application/json",
              "X-CSRF-TOKEN": csrfToken
          },
          body: JSON.stringify(formData)
      })
      .then(res => res.json())
      .then(data => {
          if (data.success) {
              Swal.fire({
                  icon: 'success',
                  title: 'Registro exitoso',
                  text: data.message,
                  confirmButtonColor: '#198754'
              }).then(() => {
                  // Cerrar modal
                  const modal = bootstrap.Modal.getInstance(document.getElementById('registroModal'));
                  modal.hide();
                  // Limpiar formulario
                  document.getElementById("registroForm").reset();
              });
          } else {
              Swal.fire({
                  icon: 'error',
                  title: 'Error',
                  text: data.message,
                  confirmButtonColor: '#dc3545'
              });
          }
      })
      .catch(() => {
          Swal.fire({
              icon: 'error',
              title: 'Error',
              text: 'Ocurrió un problema al registrar el usuario',
              confirmButtonColor: '#dc3545'
          });
      });
  });
</script>


</body>

</html>